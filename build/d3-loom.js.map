{"version":3,"file":"d3-loom.js","sources":["../src/compare-value.js","../src/constant.js","../src/loom.js","../src/string.js"],"sourcesContent":["export default function compareValue(compare) {\n  return (a, b) => compare(a.outer.value, b.outer.value);\n}\n","export default function constant(x) {\n  return () => x;\n}\n","/* Based on the d3v4 d3.chord() function by Mike Bostock\n** Adjusted by Nadieh Bremer - July 2016 */\n\n/* global d3 */\nimport compareValue from './compare-value';\nimport constant from './constant';\n\nexport default function loom() {\n  const tau = Math.PI * 2;\n\n  let padAngle = 0;\n  let sortGroups = null;\n  let sortSubgroups = null;\n  let sortLooms = null;\n  let emptyPerc = 0.2;\n  let heightInner = 20;\n  let widthInner = () => 30;\n  let value = d => d.value;\n  let inner = d => d.inner;\n  let outer = d => d.outer;\n\n  function loomLayout(layoutData) {\n    // Nest the data on the outer variable\n    const data = d3.nest().key(outer).entries(layoutData);\n\n    const n = data.length;\n\n    // Loop over the outer groups and sum the values\n\n    const groupSums = [];\n    const groupIndex = d3.range(n);\n    const subgroupIndex = [];\n    const looms = [];\n    looms.groups = new Array(n);\n    const groups = looms.groups;\n    let numSubGroups;\n    looms.innergroups = [];\n    const uniqueInner = looms.innergroups;\n    const uniqueCheck = [];\n    let k;\n    let x;\n    let x0;\n    let j;\n    let l;\n    let s;\n    let v;\n    let sum;\n    let section;\n    let remain;\n    let counter;\n    let reverseOrder = false;\n    let approxCenter;\n    k = 0;\n    numSubGroups = 0;\n    for (let i = 0; i < n; i += 1) {\n      v = data[i].values.length;\n      sum = 0;\n      for (j = 0; j < v; j += 1) {\n        sum += value(data[i].values[j]);\n      } // for j\n      groupSums.push(sum);\n      subgroupIndex.push(d3.range(v));\n      numSubGroups += v;\n      k += sum;\n    } // for i\n\n    // Sort the groups…\n    if (sortGroups) {\n      groupIndex.sort((a, b) => sortGroups(groupSums[a], groupSums[b]));\n    }\n\n    // Sort subgroups…\n    if (sortSubgroups) {\n      subgroupIndex.forEach((d, i) => {\n        d.sort((a, b) =>\n          sortSubgroups(inner(data[i].values[a]), inner(data[i].values[b]))\n        );\n      });\n    }\n\n    // After which group are we past the center, taking into account the padding\n    // TODO: make something for if there is no \"nice\" split in two...\n    const padk = k * (padAngle / tau);\n    l = 0;\n    for (let i = 0; i < n; i += 1) {\n      section = groupSums[groupIndex[i]] + padk;\n      l += section;\n      if (l > (k + n * padk) / 2) {\n        // Check if the group should be added to left or right\n        remain = k + n * padk - (l - section);\n        approxCenter = remain / section < 0.5\n          ? groupIndex[i]\n          : groupIndex[i - 1];\n        break;\n      } // if\n    } // for i\n\n    // How much should be added to k to make the empty part emptyPerc big of the total\n    const emptyk = k * emptyPerc / (1 - emptyPerc);\n    k += emptyk;\n\n    // Convert the sum to scaling factor for [0, 2pi].\n    k = Math.max(0, tau - padAngle * n) / k;\n    const dx = k ? padAngle : tau / n;\n\n    // Compute the start and end angle for each group and subgroup.\n    // Note: Opera has a bug reordering object literal properties!\n    const subgroups = new Array(numSubGroups);\n    x = emptyk * 0.25 * k; // starting with quarter of the empty part to the side;\n    counter = 0;\n    for (let i = 0; i < n; i += 1) {\n      const di = groupIndex[i];\n      const outername = data[di].key;\n\n      x0 = x;\n      s = subgroupIndex[di].length;\n      for (j = 0; j < s; j += 1) {\n        const dj = reverseOrder\n          ? subgroupIndex[di][s - 1 - j]\n          : subgroupIndex[di][j];\n\n        v = value(data[di].values[dj]);\n        const innername = inner(data[di].values[dj]);\n        const a0 = x;\n        x += v * k;\n        const a1 = x;\n        subgroups[counter] = {\n          index: di,\n          subindex: dj,\n          startAngle: a0,\n          endAngle: a1,\n          value: v,\n          outername,\n          innername,\n          groupStartAngle: x0\n        };\n\n        // Check and save the unique inner names\n        if (!uniqueCheck[innername]) {\n          uniqueCheck[innername] = true;\n          uniqueInner.push({ name: innername });\n        } // if\n\n        counter += 1;\n      } // for j\n      groups[di] = {\n        index: di,\n        startAngle: x0,\n        endAngle: x,\n        value: groupSums[di],\n        outername\n      };\n      x += dx;\n      // If this is the approximate center, add half of the empty piece for the bottom\n      if (approxCenter === di) x += emptyk * 0.5 * k;\n      // If you've crossed the bottom, reverse the order of the inner strings\n      if (x > Math.PI) reverseOrder = true;\n    } // for i\n\n    // Sort the inner groups in the same way as the strings\n    if (sortSubgroups) {\n      uniqueInner.sort((a, b) => sortSubgroups(a.name, b.name));\n    }\n\n    // Find x and y locations of the inner categories\n    const m = uniqueInner.length;\n    for (let i = 0; i < m; i += 1) {\n      uniqueInner[i].x = 0;\n      uniqueInner[i].y = -m * heightInner / 2 + i * heightInner;\n      uniqueInner[i].offset = widthInner(uniqueInner[i].name, i);\n    } // for i\n\n    // Generate bands for each (non-empty) subgroup-subgroup link\n    counter = 0;\n    for (let i = 0; i < n; i += 1) {\n      const di = groupIndex[i];\n      s = subgroupIndex[di].length;\n      for (j = 0; j < s; j += 1) {\n        const outerGroup = subgroups[counter];\n        const innerTerm = outerGroup.innername;\n        // Find the correct inner object based on the name\n        const innerGroup = searchTerm(innerTerm, 'name', uniqueInner);\n        if (outerGroup.value) {\n          looms.push({ inner: innerGroup, outer: outerGroup });\n        } // if\n        counter += 1;\n      } // for j\n    } // for i\n\n    const returnValue = sortLooms ? looms.sort(sortLooms) : looms;\n    console.log('returnValue from loom', returnValue); // eslint-disable-line\n    return returnValue;\n  } // loomLayout\n\n  function searchTerm(term, property, arrayToSearch) {\n    for (let i = 0; i < arrayToSearch.length; i += 1) {\n      if (arrayToSearch[i][property] === term) {\n        return arrayToSearch[i];\n      } // if\n    } // for i\n    return null;\n  } // searchTerm\n\n  loomLayout.padAngle = function(_) {\n    return arguments.length\n      ? ((padAngle = Math.max(0, _)), loomLayout)\n      : padAngle;\n  };\n\n  loomLayout.inner = function(_) {\n    return arguments.length ? ((inner = _), loomLayout) : inner;\n  };\n\n  loomLayout.outer = function(_) {\n    return arguments.length ? ((outer = _), loomLayout) : outer;\n  };\n\n  loomLayout.value = function(_) {\n    return arguments.length ? ((value = _), loomLayout) : value;\n  };\n\n  loomLayout.heightInner = function(_) {\n    return arguments.length ? ((heightInner = _), loomLayout) : heightInner;\n  };\n\n  loomLayout.widthInner = function(_) {\n    return arguments.length\n      ? ((widthInner = typeof _ === 'function' ? _ : constant(+_)), loomLayout)\n      : widthInner;\n  };\n\n  loomLayout.emptyPerc = function(_) {\n    return arguments.length\n      ? ((emptyPerc = _ < 1\n          ? Math.max(0, _)\n          : Math.max(0, _ * 0.01)), loomLayout)\n      : emptyPerc;\n  };\n\n  loomLayout.sortGroups = function(_) {\n    return arguments.length ? ((sortGroups = _), loomLayout) : sortGroups;\n  };\n\n  loomLayout.sortSubgroups = function(_) {\n    return arguments.length ? ((sortSubgroups = _), loomLayout) : sortSubgroups;\n  };\n\n  loomLayout.sortLooms = function(_) {\n    return arguments.length\n      ? (_ == null\n          ? (sortLooms = null)\n          : ((sortLooms = compareValue(_))._ = _), loomLayout)\n      : sortLooms && sortLooms._;\n  };\n\n  return loomLayout;\n} // loom\n","/* global d3 */\n\nimport constant from './constant';\n\nexport default function string() {\n  const slice = Array.prototype.slice;\n  const cos = Math.cos;\n  const sin = Math.sin;\n  const halfPi = Math.PI / 2;\n  const tau = Math.PI * 2;\n\n  let inner = d => d.inner;\n  let outer = d => d.outer;\n  let radius = () => 100;\n  let groupStartAngle = d => d.groupStartAngle;\n  let startAngle = d => d.startAngle;\n  let endAngle = d => d.endAngle;\n  let x = d => d.x;\n  let y = d => d.y;\n  let offset = d => d.offset;\n  let pullout = 50;\n  let thicknessInner = 0;\n  let context = null;\n\n  function stringLayout() {\n    // console.log('arguments from stringLayout', arguments); // eslint-disable-line\n    let buffer;\n    const argv = slice.call(arguments); // eslint-disable-line\n    console.log('argv', argv); // eslint-disable-line\n    const out = outer.apply(this, argv);\n    const inn = inner.apply(this, argv);\n    argv[0] = out;\n    const sr = +radius.apply(this, argv);\n    const sa0 = startAngle.apply(this, argv) - halfPi;\n    const sga0 = groupStartAngle.apply(this, argv) - halfPi;\n    const sa1 = endAngle.apply(this, argv) - halfPi;\n    let sx0 = sr * cos(sa0);\n    const sy0 = sr * sin(sa0);\n    let sx1 = sr * cos(sa1);\n    const sy1 = sr * sin(sa1);\n    argv[0] = inn;\n    // 'tr' is assigned a value but never used\n    // const tr = +radius.apply(this, (argv));\n    // console.log('x', x); // eslint-disable-line\n    // console.log('y', y); // eslint-disable-line\n    // console.log('this', this); // eslint-disable-line\n    let tx = x.apply(this, argv);\n    const ty = y.apply(this, argv);\n    let toffset = offset.apply(this, argv);\n    // console.log('tx', tx); // eslint-disable-line\n    // console.log('ty', ty); // eslint-disable-line\n    // console.log('toffset', toffset); // eslint-disable-line\n    let xco;\n    let yco;\n    let xci;\n    let yci;\n\n    // Does the group lie on the left side;\n    const leftHalf = sga0 + halfPi > Math.PI && sga0 + halfPi < tau;\n    // If the group lies on the other side, switch the inner point offset\n    if (leftHalf) toffset = -toffset;\n    tx += toffset;\n    // And the height of the end point\n    const theight = leftHalf ? -thicknessInner : thicknessInner;\n\n    if (!context) {\n      buffer = d3.path();\n      context = buffer;\n    }\n\n    // Change the pullout based on where the stringLayout is\n    const pulloutContext = (leftHalf ? -1 : 1) * pullout;\n    sx0 += pulloutContext;\n    sx1 += pulloutContext;\n\n    // Start at smallest angle of outer arc\n    context.moveTo(sx0, sy0);\n    // console.log('context', context); // eslint-disable-line\n    // Circular part along the outer arc\n    context.arc(pulloutContext, 0, sr, sa0, sa1);\n    // console.log('context', context); // eslint-disable-line\n    // From end outer arc to center (taking into account the pullout)\n    xco = d3.interpolateNumber(pulloutContext, sx1)(0.5);\n    yco = d3.interpolateNumber(0, sy1)(0.5);\n    if ((!leftHalf && sx1 < tx) || (leftHalf && sx1 > tx)) {\n      // If the outer point lies closer to the center than the inner point\n      xci = tx + (tx - sx1) / 2;\n      yci = d3.interpolateNumber(ty + theight / 2, sy1)(0.5);\n    } else {\n      xci = d3.interpolateNumber(tx, sx1)(0.25);\n      yci = ty + theight / 2;\n    } // else\n    context.bezierCurveTo(xco, yco, xci, yci, tx, ty + theight / 2);\n    // console.log('context after bezierCurveTo', context); // eslint-disable-line\n    // Draw a straight line up/down (depending on the side of the circle)\n    // console.log(`tx ${tx} ty ${ty}, theight ${theight}`); // eslint-disable-line\n    context.lineTo(tx, ty - theight / 2);\n    // console.log('context after lineTo', context); // eslint-disable-line\n    // From center (taking into account the pullout) to start of outer arc\n    xco = d3.interpolateNumber(pulloutContext, sx0)(0.5);\n    yco = d3.interpolateNumber(0, sy0)(0.5);\n    if ((!leftHalf && sx0 < tx) || (leftHalf && sx0 > tx)) {\n      // If the outer point lies closer to the center than the inner point\n      xci = tx + (tx - sx0) / 2;\n      yci = d3.interpolateNumber(ty - theight / 2, sy0)(0.5);\n    } else {\n      xci = d3.interpolateNumber(tx, sx0)(0.25);\n      yci = ty - theight / 2;\n    } // else\n    context.bezierCurveTo(xci, yci, xco, yco, sx0, sy0);\n    // console.log('context', context); // eslint-disable-line\n    // Close path\n    context.closePath();\n    // console.log('context', context); // eslint-disable-line\n\n    // console.log('buffer from string', buffer); // eslint-disable-line\n    if (buffer) {\n      context = null;\n      return `${buffer}` || null;\n    }\n    return null;\n  }\n\n  stringLayout.radius = function(_) {\n    return arguments.length\n      ? ((radius = typeof _ === 'function' ? _ : constant(+_)), stringLayout)\n      : radius;\n  };\n\n  stringLayout.groupStartAngle = function(_) {\n    return arguments.length\n      ? ((groupStartAngle = typeof _ === 'function'\n          ? _\n          : constant(+_)), stringLayout)\n      : groupStartAngle;\n  };\n\n  stringLayout.startAngle = function(_) {\n    return arguments.length\n      ? ((startAngle = typeof _ === 'function'\n          ? _\n          : constant(+_)), stringLayout)\n      : startAngle;\n  };\n\n  stringLayout.endAngle = function(_) {\n    return arguments.length\n      ? ((endAngle = typeof _ === 'function' ? _ : constant(+_)), stringLayout)\n      : endAngle;\n  };\n\n  stringLayout.x = function(_) {\n    return arguments.length ? ((x = _), stringLayout) : x;\n  };\n\n  stringLayout.y = function(_) {\n    return arguments.length ? ((y = _), stringLayout) : y;\n  };\n\n  stringLayout.offset = function(_) {\n    return arguments.length ? ((offset = _), stringLayout) : offset;\n  };\n\n  stringLayout.thicknessInner = function(_) {\n    return arguments.length\n      ? ((thicknessInner = _), stringLayout)\n      : thicknessInner;\n  };\n\n  stringLayout.inner = function(_) {\n    return arguments.length ? ((inner = _), stringLayout) : inner;\n  };\n\n  stringLayout.outer = function(_) {\n    return arguments.length ? ((outer = _), stringLayout) : outer;\n  };\n\n  stringLayout.pullout = function(_) {\n    return arguments.length ? ((pullout = _), stringLayout) : pullout;\n  };\n\n  stringLayout.context = function(_) {\n    return arguments.length\n      ? ((context = _ == null ? null : _), stringLayout)\n      : context;\n  };\n\n  return stringLayout;\n}\n"],"names":["compareValue","compare","a","b","outer","value","constant","x","loom","tau","Math","PI","padAngle","sortGroups","sortSubgroups","sortLooms","emptyPerc","heightInner","widthInner","d","inner","loomLayout","layoutData","data","d3","nest","key","entries","n","length","groupSums","groupIndex","range","subgroupIndex","looms","groups","Array","numSubGroups","innergroups","uniqueInner","uniqueCheck","k","x0","j","l","s","v","sum","section","remain","counter","reverseOrder","approxCenter","i","values","push","sort","forEach","padk","emptyk","max","dx","subgroups","di","outername","dj","innername","a0","a1","name","m","y","offset","outerGroup","innerTerm","innerGroup","searchTerm","returnValue","log","term","property","arrayToSearch","_","arguments","string","slice","prototype","cos","sin","halfPi","radius","groupStartAngle","startAngle","endAngle","pullout","thicknessInner","context","stringLayout","buffer","argv","call","out","apply","inn","sr","sa0","sga0","sa1","sx0","sy0","sx1","sy1","tx","ty","toffset","xco","yco","xci","yci","leftHalf","theight","path","pulloutContext","moveTo","arc","interpolateNumber","bezierCurveTo","lineTo","closePath"],"mappings":"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"}