!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("d3-collection"),require("d3-array"),require("d3-interpolate"),require("d3-path")):"function"==typeof define&&define.amd?define(["exports","d3-collection","d3-array","d3-interpolate","d3-path"],t):t(n.d3=n.d3||{},n.d3,n.d3,n.d3,n.d3)}(this,function(n,t,e,r,u){"use strict";function o(n){return function(t,e){return n(t.outer.value,e.outer.value)}}function i(n){function t(n){n=d3.nest().key(v).entries(n);var t,r,o,m,b,A,x,N,M,I,P,k,q,S,T,_,w,j,z,C=n.length,E=[],G=d3.range(C),L=[],O=[],B=O.groups=new Array(C),D=O.innergroups=[],F=[],H=!1;for(m=0,r=0,N=0;N<C;N++){for(q=n[N].values.length,S=0,M=0;M<q;M++)S+=d(n[N].values[M]);E.push(S),L.push(d3.range(q)),r+=q,m+=S}for(a&&G.sort(function(n,t){return a(E[n],E[t])}),c&&L.forEach(function(t,e){t.sort(function(t,r){return c(y(n[e].values[t]),y(n[e].values[r]))})}),T=m*(f/i),I=0,N=0;N<C;N++)if(_=E[G[N]]+T,(I+=_)>(m+C*T)/2){w=m+C*T-(I-_),z=w/_<.5?G[N]:G[N-1];break}for(o=m*h/(1-h),m+=o,m=l(0,i-f*C)/m,x=m?f:i/C,t=new Array(r),b=.25*o*m,j=0,N=0;N<C;N++){var J=G[N],K=n[J].key;for(A=b,k=L[J].length,M=0;M<k;M++){var Q=H?L[J][k-1-M]:L[J][M],q=d(n[J].values[Q]),R=y(n[J].values[Q]),U=b,V=b+=q*m;t[j]={index:J,subindex:Q,startAngle:U,endAngle:V,value:q,outername:K,innername:R,groupStartAngle:A},F[R]||(F[R]=!0,D.push({name:R})),j+=1}B[J]={index:J,startAngle:A,endAngle:b,value:E[J],outername:K},b+=x,z===J&&(b+=.5*o*m),b>u&&(H=!0)}for(c&&D.sort(function(n,t){return c(n.name,t.name)}),P=D.length,N=0;N<P;N++)D[N].x=0,D[N].y=-P*s/2+N*s,D[N].offset=g(D[N].name,N);for(j=0,N=0;N<C;N++){var J=G[N];for(k=L[J].length,M=0;M<k;M++){var W=t[j],X=W.innername,Y=e(X,"name",D);W.value&&O.push({inner:Y,outer:W}),j+=1}}return p?O.sort(p):O}function e(n,t,e){for(var r=0;r<e.length;r++)if(e[r][t]===n)return e[r]}function r(n){return function(){return n}}var u=Math.PI,i=2*u,l=Math.max,f=0,a=null,c=null,p=null,h=.2,s=20,g=function(n,t){return 30},d=function(n){return n.value},y=function(n){return n.inner},v=function(n){return n.outer};return t.padAngle=function(n){return arguments.length?(f=l(0,n),t):f},t.inner=function(n){return arguments.length?(y=n,t):y},t.outer=function(n){return arguments.length?(v=n,t):v},t.value=function(n){return arguments.length?(d=n,t):d},t.heightInner=function(n){return arguments.length?(s=n,t):s},t.widthInner=function(n){return arguments.length?(g="function"==typeof n?n:r(+n),t):g},t.emptyPerc=function(n){return arguments.length?(h=n<1?l(0,n):l(0,.01*n),t):h},t.sortGroups=function(n){return arguments.length?(a=n,t):a},t.sortSubgroups=function(n){return arguments.length?(c=n,t):c},t.sortLooms=function(n){return arguments.length?(null==n?p=null:(p=o(n))._=n,t):p&&p._},t}function l(){function n(){var n,t,A,x,N,M,I,P,k=e.call(arguments),q=a.apply(this,k),S=f.apply(this,k),T=+c.apply(this,(k[0]=q,k)),_=h.apply(this,k)-i,w=p.apply(this,k)-i,j=s.apply(this,k)-i,z=T*r(_),C=T*u(_),E=T*r(j),G=T*u(j),L=(c.apply(this,(k[0]=S,k)),g.apply(this,k)),O=d.apply(this,k),B=y.apply(this,k);if(I=w+i>o&&w+i<l,I&&(B=-B),L+=B,t=I?-m:m,b||(b=n=d3.path()),P=(I?-1:1)*v,z+=P,E+=P,b.moveTo(z,C),b.arc(P,0,T,_,j),A=d3.interpolateNumber(P,E)(.5),x=d3.interpolateNumber(0,G)(.5),!I&&E<L||I&&E>L?(N=L+(L-E)/2,M=d3.interpolateNumber(O+t/2,G)(.5)):(N=d3.interpolateNumber(L,E)(.25),M=O+t/2),b.bezierCurveTo(A,x,N,M,L,O+t/2),b.lineTo(L,O-t/2),A=d3.interpolateNumber(P,z)(.5),x=d3.interpolateNumber(0,C)(.5),!I&&z<L||I&&z>L?(N=L+(L-z)/2,M=d3.interpolateNumber(O-t/2,C)(.5)):(N=d3.interpolateNumber(L,z)(.25),M=O-t/2),b.bezierCurveTo(N,M,A,x,z,C),b.closePath(),n)return b=null,n+""||null}function t(n){return function(){return n}}var e=Array.prototype.slice,r=Math.cos,u=Math.sin,o=Math.PI,i=o/2,l=2*o,f=(Math.max,function(n){return n.inner}),a=function(n){return n.outer},c=function(n){return 100},p=function(n){return n.groupStartAngle},h=function(n){return n.startAngle},s=function(n){return n.endAngle},g=function(n){return n.x},d=function(n){return n.y},y=function(n){return n.offset},v=50,m=0,b=null;return n.radius=function(e){return arguments.length?(c="function"==typeof e?e:t(+e),n):c},n.groupStartAngle=function(e){return arguments.length?(p="function"==typeof e?e:t(+e),n):p},n.startAngle=function(e){return arguments.length?(h="function"==typeof e?e:t(+e),n):h},n.endAngle=function(e){return arguments.length?(s="function"==typeof e?e:t(+e),n):s},n.x=function(t){return arguments.length?(g=t,n):g},n.y=function(t){return arguments.length?(d=t,n):d},n.offset=function(t){return arguments.length?(y=t,n):y},n.thicknessInner=function(t){return arguments.length?(m=t,n):m},n.inner=function(t){return arguments.length?(f=t,n):f},n.outer=function(t){return arguments.length?(a=t,n):a},n.pullout=function(t){return arguments.length?(v=t,n):v},n.context=function(t){return arguments.length?(b=null==t?null:t,n):b},n}n.loom=i,n.string=l,Object.defineProperty(n,"__esModule",{value:!0})});